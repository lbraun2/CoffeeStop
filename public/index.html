<!DOCTYPE html>
<html lang="en" ng-app="coffeeApp">
   <head>
      <meta charset="utf-8">
	  <meta name="viewport" content="width=device-width">
      <title>COFFEE SHOP</title>
      <link rel="shortcut icon" href="">
      <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>

      <script src="https://fb.me/react-15.0.0.js"></script>
      <script src="https://fb.me/react-with-addons-15.1.0.js"></script>
      <script src="https://fb.me/react-dom-15.0.0.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.min.js"></script>
      <script src="https://npmcdn.com/react-router/umd/ReactRouter.min.js"></script>

      <script src="https://www.gstatic.com/firebasejs/3.4.0/firebase-app.js"></script>
      <script src="https://www.gstatic.com/firebasejs/3.4.0/firebase-auth.js"></script>
      <script src="https://www.gstatic.com/firebasejs/3.4.0/firebase.js"></script>
      <script src="https://cdn.firebase.com/libs/reactfire/1.0.0/reactfire.min.js"></script>

      <script src="https://d3js.org/d3.v4.min.js"></script>

    <!--  <link rel="stylesheet" type="text/css" href="../jasmine/lib/jasmine-2.5.2/jasmine.css">
      <script type="text/javascript" src="../jasmine/lib/jasmine-2.5.2/jasmine.js"></script>
      <script type="text/javascript" src="../jasmine/lib/jasmine-2.5.2/jasmine-html.js"></script>
      <script type="text/javascript" src="../jasmine/lib/jasmine-2.5.2/boot.js"></script>

      <script type="text/javascript" src="CoffeeSpec.js"></script> -->

      <link rel="stylesheet" type="text/css" href="style.css">
   </head>
   <body>
      <div id="main"></div>
      <script>
        "use strict";
          // Initialize Firebase
          var config = {
            apiKey: "AIzaSyD9xeq34gctsKfIajyTC7DRo1o13knB-zU",
            authDomain: "coffeestop-820c3.firebaseapp.com",
            databaseURL: "https://coffeestop-820c3.firebaseio.com",
            storageBucket: "coffeestop-820c3.appspot.com",
            messagingSenderId: "282398477281"
          };
          firebase.initializeApp(config);

          var ref = firebase.database().ref("users");

          function registerUser(){
                var email = $("#userEmail").val();
                var password = $("#userPassword").val();
                var firstName = $("#firstName").val();

                 $.post("http://localhost:3000/newUser",{ todoText: email});

                firebase.auth().createUserWithEmailAndPassword(email, password).then(function(user){
                    ref.push({
                      id: user.uid,
                      name: firstName
                    });

                    alert("Welcome, " + firstName + "!");
                }), function(error){

                  var errorCode = error.code;
                  var errorMessage = error.message;
                  alert(errorMessage);
                };
          }; 
      </script>
      <script type="text/babel">
         var {
           Router,
           Route,
           IndexRoute,
           browserHistory,
           IndexLink,
           Link } = ReactRouter;

           var Home = React.createClass({
             render: function() {
               console.log("hi");
               return (
               <div>
                <div className="homepageSearch">
                  <input name="homepageSearch" id="searching" placeholder="Enter your address, city/state, or zipcode.." />
                  <Link to="/search"><button className="nearMe">Find coffee near me</button></Link>
               </div>
               </div>
             );
           }
         });

         var LoginRegister = React.createClass({
           render: function() {
               return (
                 <div className="content">
                     <Login/>
                     <Register/>
                 </div>
               );
             }
         });

         var Login = React.createClass({
           render: function() {
               return (
                 <div>
                 <p>L O G I N</p>
                   <form name="login" className="login">
                     <input  type="email" name="email" placeholder="Email Address"/>
                     <input  type="password" name="password" placeholder="Password"/>
                     <button>Sign in</button>
                   </form>
                 </div>
               );
             }
         });

         var Register =  React.createClass({
            render: function() {
                return (
                  <div>
                  <p>R E G I S T E R</p>
                  <form name="registration" id="registration">
                            <label for="firstName">First Name</label>
                            <input type="text" id="firstName" name="firstName"/>

                            <label for="email">Email</label>
                            <input type="email" id="userEmail" name="email"/>
                            <div class="error">Please enter a valid email</div>

                            <label for="password">Password (between 6-12 characters)</label>
                            <input type="password" id="userPassword" name="password" pattern="[^\s]{6,12}$" title="6-12 character password"/>
                            <div class="error">Your password must be between 6-12 characters</div>
                    <button onclick="registerUser()" id="register">Join Now</button>
                  </form>
                  </div>
                );
              }
          });

         var Search = React.createClass({
           render: function() {
               return (
                 <div className="content">
                     <p>SEARCH RESULTS</p>
                     <div id="locationField">
                     <input id="autocomplete" placeholder="Enter an address" type="text" />
                     </div>

                     <div id="map"></div>

                     <div id="listing">
                     <table id="resultsTable">
                       <tbody id="results"></tbody>
                     </table>
                     </div>

                     <div>
                     <div id="info-content">
                       <table>
                       <tbody>
                         <tr id="iw-url-row" class="iw_table_row">
                           <td id="iw-icon" class="iw_table_icon"></td>
                           <td id="iw-url"></td>
                         </tr>
                         <tr id="iw-address-row" class="iw_table_row">
                           <td class="iw_attribute_name">Address:</td>
                           <td id="iw-address"></td>
                         </tr>
                         <tr id="iw-phone-row" class="iw_table_row">
                           <td class="iw_attribute_name">Telephone:</td>
                           <td id="iw-phone"></td>
                         </tr>
                         <tr id="iw-rating-row" class="iw_table_row">
                           <td class="iw_attribute_name">Rating:</td>
                           <td id="iw-rating"></td>
                         </tr>
                         <tr id="iw-website-row" class="iw_table_row">
                           <td class="iw_attribute_name">Website:</td>
                           <td id="iw-website"></td>
                         </tr>
                        </tbody>
                       </table>
                     </div>
                     </div>
					 <p> Ratings </p>
					 <div className="chart"></div>

                 </div>

               );
             }
         });

         var App = React.createClass({
           mixins: [ReactFireMixin],
           render: function() {
             return (
               <div>
               <header><Link to="/">COFFEE STOP</Link>
                 <div id="options">
                 <Link to="/login-register"><button>LOG-IN/SIGN-UP</button></Link>
                 </div>
               </header>

                 <div className="mainArea">{this.props.children}</div>
                 <footer><strong>SWE 432 - Ellen Nkonya & Laura Braun</strong></footer>
               </div>
             )
           }
         });

         ReactDOM.render(
         <Router history={browserHistory}>
           <Route path="/" component={App}>
               <IndexRoute component={Home}/>
              <Route path="login-register" component={LoginRegister} />
              <Route path="search" component={Search} />
           </Route>
         </Router>,
         document.getElementById("main")
         );


      </script>

      <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDF9KYCmkJ-TfR0npZmnfvjRfMlNKJK1pk&libraries=places&callback=initMap"
         async defer></script>
      <script type="text/javascript" src="gmaps.js"></script>
   </body>
</html>
